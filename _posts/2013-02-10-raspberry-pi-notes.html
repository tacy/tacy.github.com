---
layout: post
categories: [tech]
title: "Raspberry Pi安装配置和问题记录"
description: "个人在安装配置raspberry pi过程中的记录，包括相关遇到问题的解决办法，主要包括配件购买、系统安装、基本配置。最终实现通过hdmi接口和电视连接播放视频。"
tags: [raspberry pi, configure]
---

<p>
Raspberry Pi简单来说就是一个低功耗的卡片PC主机，当然他的处理能力要弱很多，可以是用来教孩子编程，放高清（带GPU和HDMI输出），当然你可以用它来做很多事情，如果你动手能力强，也可以自己扩展他，一切皆有可能。
</p>
<p>
Raspberry Pi主要分为两个型号，A型号是低配，B型号是高配，我用的是B板，这里都是基于B板的描述，板子包括2个2.0的USB口，一个LAN口，HDMI/RCA/AUDIO输出口个一个，一个MicroUSB口负责电源接入。可以看到，如果完整运行Raspberry Pi还需要一些输入输出设备，他自己就类似一个PC主机。下面是我配置Raspberry Pi时候涉及到的一些相关步骤。
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">初步的配置目的</h2>
<div class="outline-text-2" id="text-1">

<p>配置简单的Raspberry Pi，使之能通过HDMI连接TV播放视频。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">购置的配件</h2>
<div class="outline-text-2" id="text-2">

<p>Raspberry Pi板子就不用说了，淘宝到处都是，我买的是B板，其他的需要购买的配件包括：
</p><ul>
<li>一个USB键盘

<p>
  我买的是无线键鼠套装，方便点，毕竟未来会放在客厅用，有线总是个累赘。
</p></li>
<li>一根HDMI线

<p>
   连接电视用，HDMI可以同时负责视频和音频传输，也可以用RCA接口和AUDIO接口接入电视，问题也不大。只是高清自然是不行了，这样太对不起Raspberry Pi了吧。
</p></li>
<li>一根网线

<p>
  当然你的有有线网络接入，如果你家里只有无线接入，可以通过购置一个带有线口的无线设备做repeater接入，我用的是tplink 的TL-WR710N。
</p></li>
<li>一张SDHC卡

<p>
  我买的Kingston 16G class4，买之前最好去网上查查是否支持<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup>，据说Raspberry Pi挑卡。
</p></li>
<li>一个放置Raspberry Pi的盒子

<p>
  固定和防尘用（我忘了买，挺麻烦的，不好固定，简单用个纸盒先凑合着）。
</p></li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">安装系统</h2>
<div class="outline-text-2" id="text-3">

<p>第一步自然是把线接好，这个就不多说了，如果你和我一样，没有买固定的盒子，还是注意经典和力度，比较板子还是挺脆弱的。然后下载系统镜像，Raspberry Pi官网提供几个版本的镜像下载，我直接用的最简单的那个版本wheezy，基于Debian的Raspbian预配置版本，带桌面和浏览器以及开发工具和一些示例的多媒体代码，安装好之后就能用，下载地址：<a href="http://www.raspberrypi.org/downloads">Raspberry Pi Download</a>，准备总做就做好了。
</p>

</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">写入系统到SD</h3>
<div class="outline-text-3" id="text-3-1">

<p>我用的是Ubuntu系统，机器自带SD读卡器，直接插入SD卡，检查SD卡路径：
</p>



<pre class="example">$sudo fdisk -l
</pre>


<p>
通常都是sdb，不清楚你就对比一下插入前后的输出，如果你的SD卡已经分区，并且自动mount了，记得unmount它，接下来我们写入下载的系统镜像文件：
</p>



<pre class="example">$unzip 2012-12-16-wheezy-raspbian.zip
$sudo dd bs=1M if=2012-12-16-wheezy-raspbian of=/dev/sdb
</pre>


<p>
等上几分钟或者十几分钟，视SD卡速度而定，完成之后弹出SD卡，插入Raspberry Pi卡槽中，通过MicroUSB插入电源，注意电源一般的手机充电器都可以，前提是输出需要大于700毫安，我试过IPad充电器也可以（2100mA），Rasberry Pi不带开关，电源插入自动开机，关机只能拔电源，正常就可以在TV上看到Rasberry Pi的启动过程了。
</p>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2">配置Rasberry Pi</h3>
<div class="outline-text-3" id="text-3-2">

<p>第一次系统启动自动进入Raspi-config配置界面，设置正确的timezone、locale(en_US.UTF8)、Keyboard（Generic 105-key intel PC)、ssh enable，最后是expand-rootfs，完成重启系统。
</p>
<p>
经过漫长的expand rootfs之后，终于来到登入终端，用pi/raspberry登入系统，用命令startx启动进入xwindows，这时候你应该就可以正常上网了（lan通过dhcp自动获取ip地址）。
</p>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3">中文环境配置</h3>
<div class="outline-text-3" id="text-3-3">

<p>缺省我用的是en_us.utf8环境，当然我也不打算修改，我需要的只是显示中文和输入中文，只需安装字体和输入法。
</p>



<pre class="example">$sudo apt-get install ttf-wqy-zenhei
$sudo apt-get install scim-pinyin
</pre>


</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4">播放视频</h3>
<div class="outline-text-3" id="text-3-4">

<p>系统缺省安装了omxplayer播放器，这是一个命令行播放器,GPU支持，上传一个视频，播放视频看效果：
</p>



<pre class="example">$omxplayer test.avi
</pre>


<p>
另外提醒一下，omxplayer支持不启动xwindows播放视频，我之前一直以为必须启动xwindows才行，估计其他的播放器也都一样，确实没太注意，如果你需要播放视频，你可以直接在远程通过ssh登入Raspberry Pi，执行omxplayer命令，视频会直接显示在电视上，不管你是不是启动了xwindows。
</p>
<p>
Enjoying!
</p>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">远程控制</h2>
<div class="outline-text-2" id="text-4">

<p>支持控制，包括终端控制的ssh和远程桌面的vnc、rdp等，我这里用了简单的共享键盘方式，通过和客户端共享一套输入设备实现，简单说就是用我的笔记本键盘鼠标操作Raspberry Pi的桌面（我这里是电视），实现方式：
</p><ul>
<li>修改ssh允许X11 Forward




<pre class="example">$sudo vi /etc/ssh/sshd_config
</pre>


<p>
  设置X11Forwarding的值为yes，重启sshd
</p>
</li>
<li>在Raspberry Pi上安装x2x




<pre class="example">$sudo apt-get install x2x
</pre>


</li>
<li>在你的客户端远程登入Raspberry Pi




<pre class="example">$ssh -X pi@192.168.1.104 'x2x -east -to :0'
</pre>

</li>
</ul>


<p>
配置完成，当然这里你的Raspberry Pi上的xwindows必须启动才行，移动你的鼠标到最右边试试看，鼠标跑到电视上去了。
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">XBMC</h2>
<div class="outline-text-2" id="text-5">

<p>播放本地视频用omxplayer基本上能解决了，但是对于播放网络视频比如youku啥的，靠xwindows自然是不给力，毕竟一个Raspberry Pi的cpu太弱了，很容易跑死，XBMC自然是不二的选择。
</p>
<p>
XMBC针对Raspberry Pi有几个发布版本，集成OS，直接刷就行了，我已经刷好了系统，自然选择通过deb方式来安装了，查了查，热心人已经发布了编译好的包，参考<a href="http://michael.gorven.za.net/raspberrypi/xbmc">http://michael.gorven.za.net/raspberrypi/xbmc</a> 安装即可，对于中文支持，直接设置就可以了，先设置字体：
</p><ul>
<li>先设置字体：System - Settings - Appearance - Skin - Fonts  选择Arial based
</li>
<li>然后选择中文：System - Settings - Appearance - International - Language 选择Chinese（Simple)
</li>
</ul>


<p>
然后是安装视频网站插件，缺省都是国外的视频网站，需要支持国内的视频网站，需要先安装插件，去这里<a href="http://code.google.com/p/xbmc-addons-chinese/">http://code.google.com/p/xbmc-addons-chinese/</a> 下载插件repository.googlecode.xbmc-addons-chinese-eden.zip，然后通过XBMC安装就可以了。
</p>
<p>
播放视频的时候CPU在55%左右，还是有点偏高，还得研究研究怎么优化一下。
</p>
<p>
具体的XBMC键盘控制参考<a href="http://wiki.xbmc.org/index.php?title=Keyboard">http://wiki.xbmc.org/index.php?title=Keyboard</a>
</p>

</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1">字体</h3>
<div class="outline-text-3" id="text-5-1">

<p>xbmc的缺省字体字符集应该不是gbk的，显示中文很多子都是方块，我直接用wqy替换，没找到怎么新增字体的方法：
</p>



<pre class="example">$sudo cp /usr/share/fonts/truetype/wqy/wqy-zenhei.ttc arial.ttf /usr/share/xbmc/media/Fonts/
</pre>


<p>
备份arial.ttf，然后重命名wqy字体即可
</p>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2">超频</h3>
<div class="outline-text-3" id="text-5-2">

<p>Raspberry Pi运行XBMC负载很重，很容易就跑到100%，可以尝试超频，不过这个要小心，毕竟还是危险的，当然Raspberry  Pi 还是有保护措施，设置overclock时当温度超过85度时，会自动disable<sup><a class="footref" name="fnr.2" href="#fn.2">2</a></sup>，从网上情况看，超频到900应该问题不大，下面是我的设置：
</p>



<pre class="example">arm_freq=900
core_freq=450
sdram_freq=450
over_voltage=2
gpu_mem=128
arm_freq_min=700
initial_turbo=30
</pre>


<p>
设置arm_freq_min主要是因为新版本的kernel会自动调整主频，看起来好像不是很靠谱，我的长期运行在500左右，可以通过/proc/cpuinfo查看。
</p>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">遇到的问题</h2>
<div class="outline-text-2" id="text-6">

<ul>
<li>键盘配置不对

<p>
  当你按下“|”键的时候，出来的键值不对，那应该是用了GB的键盘布局，可以通过如下方式修改：
</p>


<pre class="example">$sudo vi /etc/default/keyboard
</pre>


<p>
  修改XKBLAYOUG值为“us”，重启系统。
</p>
</li>
<li>播放视频没有声音，并且视频没有满屏<sup><a class="footref" name="fnr.3" href="#fn.3">3</a></sup>

<p>
  通过如下方式修改hdmi配置
</p>


<pre class="example">$sudo vi /boot/config.txt
</pre>

<p>
  修改hdmi_drive值为2，如果改行被注释，也需要取消注释。
</p>
<p>
  通过如下命令行播放视频：
</p>


<pre class="example">$omxplayer -r -o hdmi test.avi
</pre>


</li>
<li>omxplayer中文乱码

<p>
  可以直接在omxplayer中指定字体，直接使用wqy字体即可：
</p>


<pre class="example">$omxplayer -t 1 -p -r --font /usr/share/fonts/truetype/wqy/wqy-zenhei.ttc --align center -o hdmi test.avi
</pre>


</li>
<li>omxplayer不支持外置字幕

<p>
  目前新版本omxplayer已经支持外置字幕，可以去网站上下载<sup><a class="footref" name="fnr.4" href="#fn.4">4</a></sup>，不过目前好像只支持utf-8，不行只能通过enca转码。
</p>
</li>
<li>undefined symbo问题

<p>
  “/usr/bin/omxplayer.bin: Symbol lookup error: /usr/bin/omxplayer.bin: undefined symbol: vc_xxxxxxxxxx.”
</p>
<p>
  如果你碰到类似问题，基本上是firmware没有更新，你可以通过rpi-update更新。
</p>
</li>
<li>如果你遇到一些我没遇到的问题，建议参考elinux<sup><a class="footref" name="fnr.5" href="#fn.5">5</a></sup>
</li>
</ul>


</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">一些有的资源</h2>
<div class="outline-text-2" id="text-7">

<ul>
<li>[Raspberry Pi source][http://www.raspbian.org/RaspbianMirrors]
</li>
</ul>





<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> Raspberry Pi兼容SD卡查询地址：<a href="http://elinux.org/RPi_SD_cards">http://elinux.org/RPi\_SD\_cards</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn.2" href="#fnr.2">2</a></sup> Raspberry Pi 超频设置： <a href="http://elinux.org/RPi_config.txt#Overclocking">http://elinux.org/RPi\_config.txt#Overclocking</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn.3" href="#fnr.3">3</a></sup> How to get 1080p videos running on my Raspberry Pi: <a href="http://www.brianhensley.net/2012/07/how-to-get-1080p-videos-running-on-my.html?spref=fb">http://www.brianhensley.net/2012/07/how-to-get-1080p-videos-running-on-my.html?spref=fb</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn.4" href="#fnr.4">4</a></sup> elinux Raspberry Pi troubleshooting: <a href="http://elinux.org/R-Pi_Troubleshooting">http://elinux.org/R-Pi\_Troubleshooting</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn.5" href="#fnr.5">5</a></sup> omxplayer download site: <a href="http://omxplayer.sconde.net/">http://omxplayer.sconde.net/</a>
</p></div>
</div>

</div>
</div>
