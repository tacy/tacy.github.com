---
layout: post
categories: [tools]
title: 用emacs写blog
description: "一篇杂记，简单介绍了如何基于github和jekyll搭建一个简单的blog，同时通过emacs和org来写blog，我个人认为这个认为这事情还是比较复杂，适合用emacs做编辑器的人和所有爱折腾的人民。"
tags: [life, emacs]
---

<p>
断断续续写过一些blog，很多原因没有继续下去，当然自己懒是最主要的。总觉得写blog是一件很麻烦的事情：首先要找到合适的服务提供商，很多人都找一个免费的，不需要折腾嘛，直接注册就可以开写了，当然这也是有代价的，一般的免费服务即慢且广告到处漂，看的人大倒胃口，写起来也麻烦，如果纯文字的blog当然也无所谓，但咱们干技术的，多少还是需要贴些代码、图啥的，还需要在线去拷贝、粘贴，非常麻烦！当然你能在线写，但是那些个富文本框都能让人发狂，稍有不胜，前功尽弃，很打击人不是吗；另外如果我希望写东西不用一蹴而就，想写的时候就写点，这样编辑blog的功能就显得非常重要了，但是这类的功能你很难看到，即使有也很难用；当然有时候你对版面啥的不满意，希望整整，这同样也是一件X任务。
</p>

<p>
当然有些人喜欢自己折腾，自己买host，自己注册域名，用wordpress类似的产品搭建属于自己的blog，这个可控程度高点，一切都能自己控制，但是这个挺费精力的，你想我也就想写点东西，费力吧唧的折腾那些个乱七八糟的技术，不是自己的本意。当然，如果你想有一个自己专属的空间，这点代价还是值得的。
</p>

<p>
用上emacs之后，就开始寻思怎么用emacs来写blog，最好能在emacs里面写好，然后发布到blog空间，最好空间能有版本管理功能，我可以随时通过emacs对blog进行update，这样我就可以想到哪写到哪，在emacswiki上翻了翻，找到了orgmode和jekyll，翻了翻网上的文档，基本上确定就是他了，说起jekyll，这玩意还挺好玩，他就是个渲染引擎，自动把你的blog转换为html，写这东西的人是Tom Preston-Werner，这哥们同时也是github的创始人，他写了一篇blog，专门来说这事，为啥他要写jekyll，<a href="http://tom.preston-werner.com/2008/11/17/blogging-like-a-hacker.html">blogging like a hacker</a>，感兴趣的建议看看。既然是自家人，jekyll和github集成自然就没问题了，这个就解决了blog的版本管理问题，非常不错吧。在github上搭建一个blog系统，广告自然是没有了，挺美的。参考了一些文章，最终实现了在emacs用orgmode写blog，然后通过magit git到github，在github上部署jekyll，这样一个个人weblog就完成了。
</p>

<p>
具体实现基本参考<a href="http://orgmode.org/worg/org-tutorials/org-jekyll.html">Using org to Blog with Jekyll</a>
</p>

<p>
基本的流程如下：
</p>

<p>
先在自己电脑上建一个目录，比如就叫myblog，目录结构如下：
</p>

<pre class="example">
---myblog
  ---org
     ---index.org
     ---_posts
        ---2012-07-06-title-name.org
  ---jekyll
</pre>

<p>
jekyll目录直接从jekyllbootstrap check out下来的，你写文档就直接在/org/_posts写就可以了，写完之后可以通过M-x org-publish-all发布到jekyll目录下的_posts目录，然后按下面程序提交：
</p>

<p>
M-x magit-status
</p>

<p>
s键添加提交对象，之后通过c键写注释，C-c C-c提交，P键push，更新就提交到github了。
</p>

<p>
如果你碰到提交的页面没有生效， 一般都是在github上page build失败导致的，你可以在本地调试，关闭_config.yml中的auto，设置为false，然后就可以在本地看到page build失败的异常，修复即可。
</p>

<p>
另外，jekyll只能渲染body，不能包括head，所以我们在配置的时候需要设置orgmode只能包括body：
</p>
<pre class="example">
body-only t
</pre>
<p>
但是这样的话，orgmode就不能导出toc和章节编号，我自己对lisp不熟悉，就粗暴的修改了org-html.el：
先编辑下面行：
</p>
<pre class="example">
(if (and org-export-with-toc (not body-only))
</pre>
<p>
修改为：
</p>
<pre class="example">
(if (and org-export-with-toc)
</pre>
<p>
然后修改下面行：
</p>
<pre class="example">
(if (and num (not body-only))
</pre>
<p>
修改为：
:        (if (and num)
</p>

<p>
下面是我的emacs配置，供感兴趣的同学参考：
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #8B8989; font-style: italic;">;;</span><span style="color: #8B8989; font-style: italic;">org-mode</span>
<span style="color: #8b0000;">(</span>add-to-list 'load-path <span style="color: #61CE3C;">"~/.emacs.d/lisp/org-7.8.11/lisp"</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">org-install</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>add-to-list 'auto-mode-alist '<span style="color: #006400;">(</span><span style="color: #61CE3C;">"\\.org$"</span> . org-mode<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>define-key global-map <span style="color: #61CE3C;">"\C-cl"</span> 'org-store-link<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>define-key global-map <span style="color: #61CE3C;">"\C-ca"</span> 'org-agenda<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>global-set-key <span style="color: #61CE3C;">"\C-cb"</span> 'org-iswitchb<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>global-font-lock-mode 1<span style="color: #8b0000;">)</span>                     <span style="color: #8B8989; font-style: italic;">; </span><span style="color: #8B8989; font-style: italic;">for all buffers</span>
<span style="color: #8b0000;">(</span>add-hook 'org-mode-hook 'turn-on-font-lock<span style="color: #8b0000;">)</span>  <span style="color: #8B8989; font-style: italic;">; </span><span style="color: #8B8989; font-style: italic;">Org buffers only</span>
<span style="color: #8b0000;">(</span>setq org-startup-indented t<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>setq org-log-done t<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">org-publish</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>setq org-publish-project-alist '<span style="color: #006400;">(</span>
  <span style="color: #ff1493;">(</span><span style="color: #61CE3C;">"org-myblog"</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Path to your org files.</span>
          <span style="color: #FF6400;">:base-directory</span> <span style="color: #61CE3C;">"~/myblog/org/"</span>
          <span style="color: #FF6400;">:base-extension</span> <span style="color: #61CE3C;">"org"</span>

          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Path to your Jekyll project.</span>
          <span style="color: #FF6400;">:publishing-directory</span> <span style="color: #61CE3C;">"~/myblog/jekyll/"</span>
          <span style="color: #FF6400;">:recursive</span> t
          <span style="color: #FF6400;">:publishing-function</span> org-publish-org-to-html
          <span style="color: #FF6400;">:headline-levels</span> 4
          <span style="color: #FF6400;">:html-extension</span> <span style="color: #61CE3C;">"html"</span>
          <span style="color: #FF6400;">:body-only</span> t <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Only export section between &lt;body&gt; &lt;/body&gt;</span>
    <span style="color: #ff1493;">)</span>

    <span style="color: #ff1493;">(</span><span style="color: #61CE3C;">"org-static-myblog"</span>
          <span style="color: #FF6400;">:base-directory</span> <span style="color: #61CE3C;">"~/myblog/org/"</span>
          <span style="color: #FF6400;">:base-extension</span> <span style="color: #61CE3C;">"css</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">js</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">png</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">jpg</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">gif</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">pdf</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">mp3</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">ogg</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">swf</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">|</span><span style="color: #61CE3C;">php"</span>
          <span style="color: #FF6400;">:publishing-directory</span> <span style="color: #61CE3C;">"~/myblog/jekyll/"</span>
          <span style="color: #FF6400;">:recursive</span> t
          <span style="color: #FF6400;">:publishing-function</span> org-publish-attachment<span style="color: #ff1493;">)</span>

    <span style="color: #ff1493;">(</span><span style="color: #61CE3C;">"myblog"</span> <span style="color: #FF6400;">:components</span> <span style="color: #ffff00;">(</span><span style="color: #61CE3C;">"org-myblog"</span> <span style="color: #61CE3C;">"org-static-myblog"</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">turn on soft wrapping mode for org mode</span>
<span style="color: #8b0000;">(</span>add-hook 'org-mode-hook 'turn-on-visual-line-mode<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>add-hook 'message-mode-hook 'turn-on-orgstruct<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>add-hook 'message-mode-hook 'turn-on-orgstruct++<span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>add-to-list 'load-path <span style="color: #61CE3C;">"~/.emacs.d/lisp/magit"</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">magit</span><span style="color: #8b0000;">)</span>
</pre>
</div>
