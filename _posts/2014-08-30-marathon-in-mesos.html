---
layout: post
title: "marathon in mesos"
description: "基于mesos的一个PaaS实现，试用笔记以及相关知识记录"
categories: [tech]
tags: [mesos, docker, marathon, PaaS]
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 mesos</a></li>
<li><a href="#sec-2">2 marathon</a></li>
<li><a href="#sec-3">3 marathon + mesos + docker</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">mesos</h2>
<div class="outline-text-2" id="text-1">

<p>记录一下最近一周的工作，最近一周一直在看PaaS，主要是结合Docker的方案，简单看了
看，成熟的东西没有，基本都有各种问题，可以参考一下lusis写的<a href="http://blog.lusis.org/blog/2014/06/14/paas-for-realists/">PaaS for Realists</a>，
</p>
<p>
我没有去试这几个项目，未来有时间可能会做，目前我的重点在mesos上，这是<a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;uact=8&amp;ved=0CCsQFjAB&amp;url=http%3A%2F%2Fresearch.google.com%2Fpubs%2Fpub41684.html&amp;ei=IvEBVM_VJI-A8QXIlIDADQ&amp;usg=AFQjCNFhre6QW6LnswxdXZu-jLg3WXQ1eQ&amp;sig2=FWZK9sf-fke4bqNXZI_Ikg&amp;bvm=bv.74115972,d.dGc">Omega</a>的
开源实现，支持各种framework，包括hadoop/storm/spark等流行的数据处理框架，当然熟
悉这块的人也知道，资源调度器的另一个更流行的产品是YARN，但是他只支持MapReduce框
架，而mesos支持面更广，他还支持应用运行在上面，具体的比较可以参考<a href="http://www.quora.com/How-does-YARN-compare-to-Mesos">Quora上的帖子： How does YARN compare to Mesos?</a>，另外就是mesos支持docker实现隔离。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">marathon</h2>
<div class="outline-text-2" id="text-2">

<p>marathon其实就是mesos上的一个framework，一个基于mesos的PaaS实现。通过它能部署应
用，比如java、python、ruby等。利用mesos提供的HA、FT、Scale特性，你的应用天然具备
这些特性。同时应用实现容器级别的资源隔离实现，非常方便。
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">marathon + mesos + docker</h2>
<div class="outline-text-2" id="text-3">

<p>部署测试了一下，还是比较理想，只是对于docker的支持还有一些问题，下面是一些需要
注意的点：
</p>
<p>
首先mesos 0.19版本之前，支持docker都是通过External Containerization特性来支持，
需要依赖Deimos项目，0.20版本（写本文的时候，刚刚发布几天）原声支持，这里用的是
0.20版本
</p>
<p>
其次marathon目前发布的版本是0.6.1，不能支持mesos 0.20的docker特性，你需要获取源
码snapshot自己编译。
</p>
<p>
另外一个需要注意的地方是mesos对于docker网络的支持，目前之支持host模式，也就意味
着你的应用端口配置上有一些麻烦，你需要在应用启动阶段注入修改应用端口，下一个版
本应该能支持更复杂的网络配置<sup><a class="footref" name="fnr-.1" href="#fn-.1">1</a></sup>。
</p>
<p>
关于LB的问题也需要注意，目前给出的示例是通过cron方式非实时更新LB配置，不是太理
想，应该可以通过callback方式来走，会比较理想。
</p>
<p>
另外一点就是<sup><a class="footref" name="fnr-.2" href="#fn-.2">2</a></sup>：
</p>


<pre class="example">Also since we explicitly attempt to pull the image on launch,if the docker image
is only installed locally but not avaialble on the remote repository the launch
will fail as well.
</pre>

<p>
文档里面提到，如果是本地的image是不行的，必须提交到远程仓库，否则mesos会pull失败
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup> <a href="http://tnachen.wordpress.com/2014/08/19/docker-in-mesos-0-20/">Docker on Mesos 0.20</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.2" href="#fnr-.2">2</a></sup> <a href="http://mesos.apache.org/documentation/latest/docker-containerizer/">Docker Containerizer</a>
</p>



</div>
</div>

</div>
</div>
